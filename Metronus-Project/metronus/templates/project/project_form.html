{% extends "layout_base.html" %}
{% load i18n %}
{% load l10n %}

{% block title %}
    {% if form.project_id.value|slugify == '0' %}
        {% trans 'createProject' %}
    {% else %}
        {% trans 'editProject' %}
    {% endif %}
{% endblock %}

{% block content %}
    {% if form.project_id.value|slugify == '0' %}
        <h1> {% trans 'createProject' %} </h1></br>
    {% else %}
        <h1> {% trans 'editProject' %} </h1></br>
    {% endif %}

    <div id="alert_placeholder"></div>

    {% if repeated_name %}
        <div id="repeated_name" class="alert alert-warning alert-dismissible" role="alert">
            <a class="close" data-dismiss="alert">x</a>
            <span>{% trans 'projectName' %}</span>
        </div>
    {% endif %}

    <div class="row">
      <div class="col-md-12 col-sm-12 col-xs-12">
        <div class="x_panel">
          <div class="x_title">
            <h2>{% trans 'editProject' %}<small>sub title</small></h2>
            <div class="clearfix"></div>
          </div>

          <div class="x_content">
            <form class="form-horizontal form-label-left" novalidate>
              <span class="section">Personal Info</span>

              <div class="item form-group">
                <label class="control-label col-md-3 col-sm-3 col-xs-12" for="name">Name <span class="required">*</span>
                </label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <input id="name" class="form-control col-md-7 col-xs-12" data-validate-length-range="6" data-validate-words="2" name="name" placeholder="both name(s) e.g Jon Doe" required="required" type="text">
                </div>
              </div>
              <div class="item form-group">
                <label class="control-label col-md-3 col-sm-3 col-xs-12" for="email">Email <span class="required">*</span>
                </label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <input type="email" id="email" name="email" required="required" class="form-control col-md-7 col-xs-12">
                </div>
              </div>
              <div class="item form-group">
                <label class="control-label col-md-3 col-sm-3 col-xs-12" for="email">Confirm Email <span class="required">*</span>
                </label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <input type="email" id="email2" name="confirm_email" data-validate-linked="email" required="required" class="form-control col-md-7 col-xs-12">
                </div>
              </div>
              <div class="item form-group">
                <label class="control-label col-md-3 col-sm-3 col-xs-12" for="number">Number <span class="required">*</span>
                </label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <input type="number" id="number" name="number" required="required" data-validate-minmax="10,100" class="form-control col-md-7 col-xs-12">
                </div>
              </div>
              <div class="item form-group">
                <label class="control-label col-md-3 col-sm-3 col-xs-12" for="website">Website URL <span class="required">*</span>
                </label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <input type="url" id="website" name="website" required="required" placeholder="www.website.com" class="form-control col-md-7 col-xs-12">
                </div>
              </div>
              <div class="item form-group">
                <label class="control-label col-md-3 col-sm-3 col-xs-12" for="occupation">Occupation <span class="required">*</span>
                </label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <input id="occupation" type="text" name="occupation" data-validate-length-range="5,20" class="optional form-control col-md-7 col-xs-12">
                </div>
              </div>
              <div class="item form-group">
                <label for="password" class="control-label col-md-3">Password</label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <input id="password" type="password" name="password" data-validate-length="6,8" class="form-control col-md-7 col-xs-12" required="required">
                </div>
              </div>
              <div class="item form-group">
                <label for="password2" class="control-label col-md-3 col-sm-3 col-xs-12">Repeat Password</label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <input id="password2" type="password" name="password2" data-validate-linked="password" class="form-control col-md-7 col-xs-12" required="required">
                </div>
              </div>
              <div class="item form-group">
                <label class="control-label col-md-3 col-sm-3 col-xs-12" for="telephone">Telephone <span class="required">*</span>
                </label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <input type="tel" id="telephone" name="phone" required="required" data-validate-length-range="8,20" class="form-control col-md-7 col-xs-12">
                </div>
              </div>
              <div class="item form-group">
                <label class="control-label col-md-3 col-sm-3 col-xs-12" for="textarea">Textarea <span class="required">*</span>
                </label>
                <div class="col-md-6 col-sm-6 col-xs-12">
                  <textarea id="textarea" required="required" name="textarea" class="form-control col-md-7 col-xs-12"></textarea>
                </div>
              </div>
              <div class="ln_solid"></div>
              <div class="form-group">
                <div class="col-md-6 col-md-offset-3">
                  <button type="submit" class="btn btn-primary">Cancel</button>
                  <button id="send" type="submit" class="btn btn-success">Submit</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <form id="form" method="POST" class="form-horizontal">{% csrf_token %}
        <div class="row">
            {% for field in form.visible_fields %}
                <div class="form-group">
                    <label class="control-label col-md-3 col-xs-12" for="id_{{ field.name }}">{{ field.label }}</label>
                    <div class="col-md-7 col-xs-12">
                        <input class="form-control" name="{{ field.name }}" id="id_{{ field.name }}"
                               type="text" value="{{ field.value|default_if_none:"" }}">
                    </div>
                </div>
            {% endfor %}

            {% for field in form.hidden_fields %}{{ field }}{% endfor %}


            <div class="row">
                <div class="form-actions col-xs-12 text-center">
                    <input type="submit" class="btn btn-primary" value="{% trans 'confirm' %}" />
                    <a class="btn btn-danger" href="{% url 'project_list' %}">{% trans 'cancel' %}</a>
                    {% if form.project_id.value|slugify == '0' %}
                        <a class="btn btn-info" onclick="createAndContinue()">{% trans 'createAndContinue' %}</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </form>
{% endblock %}

{% block javascript %}
<script>
function error_alert(){
    showalert('{% trans 'projectError' %}','alert-error');
}
function success_alert(){
    showalert('{% trans 'projectSaved' %}','alert-success');
}
function repeated_alert(){
    showalert('{% trans 'projectName' %}','alert-warning');
}
/**
 * Función ajax de crear y continuar
 * */
function createAndContinue() {
    $.post('{% url 'project_create_async' %}',$('#form').serialize(), function(data,status) {
        document.getElementById('form').reset();
        $('#form').data('bootstrapValidator').resetForm();

        if(JSON.stringify(data['success'])=="true"){
            success_alert();
        } else if(JSON.stringify(data['repeated_name'])=="true") {
            repeated_alert();
        } else {
            error_alert();
        }
    } );
};


/**
 * Validación en cliente del formulario
 * */
$(document).ready(function() {
    $('#form').bootstrapValidator({
        feedbackIcons: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        },
        fields: {
            name: {
                validators: {
                    notEmpty: {
                        message: "{% trans 'projectNameNotNull' %}"
                    },
                }
            },


        },
    });
});
</script>
{% endblock %}
